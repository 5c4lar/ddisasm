# Restrict these test cases to systems with compatible QEMU packages.
distro:
  name: Ubuntu
  version: ["16.04", "18.04", "20.04"]

default: &default
  path: examples
  binary: ex

  # Compilation configuration.
  build:
    c: ["arm-linux-gnueabihf-gcc"]
    cpp: ["arm-linux-gnueabihf-g++"]
    optimizations: ["-O0", "-O1", "-O2", "-O3", "-Os"]
    flags: []

  # Reassembly configuration.
  reassemble:
    compiler: "arm-linux-gnueabihf-gcc"
    flags: []
    skip: false

  # Test configuration.
  test:
    wrapper: "qemu-arm -L /usr/arm-linux-gnueabihf"
    strip_exe: "arm-linux-gnueabihf-strip"
    strip: false
    skip: false

tests:
  - name: ex1_pie
    <<: *default
    path: examples/arm_asm_examples
    build:
      c: ["arm-linux-gnueabihf-gcc"]
      cpp: ["arm-linux-gnueabihf-g++"]
      flags: ["-pie"]
      optimizations: [""]

  - name: ex1_no_pie
    <<: *default
    path: examples/arm_asm_examples
    reassemble:
      compiler: "arm-linux-gnueabihf-gcc"
      flags: ["-no-pie"]
    build:
      c: ["arm-linux-gnueabihf-gcc"]
      cpp: ["arm-linux-gnueabihf-g++"]
      flags: ["-no-pie"]
      optimizations: [""]

  - name: ex1
    <<: *default

  - name: ex_2modulesPIC
    <<: *default

  - name: ex_confusing_data
    <<: *default

#  - name: ex_exceptions1 # cpp {1,2,3}: libehp currently doesn't support arm32
#    <<: *default

  - name: ex_false_pointer_array
    <<: *default

#  - name: ex_float # capstone decoder error: vmov.f32 and vmov.f64
#    <<: *default

  - name: ex_fprintf
    <<: *default

  - name: ex_getoptlong
    <<: *default

  - name: ex_memberPointer
    <<: *default
    reassemble:
      compiler: "arm-linux-gnueabihf-g++"
      flags: []
      skip: false

  - name: ex_noreturn
    <<: *default

  - name: ex_pointerReatribution
    <<: *default

  - name: ex_pointerReatribution2
    <<: *default

  - name: ex_pointerReatribution3
    <<: *default

  - name: ex_stat
    <<: *default

  - name: ex_struct
    <<: *default

  - name: ex_switch
    <<: *default
    distro:
      name: Ubuntu
      # NOTE: The assembler in ubuntu16 seems to behave differently from other
      # versions.
      # ```
      #    ldr pc, [r2, r3, lsl #2]
      #    .p2align 2
      #.L15:
      #    .word   .L14+1
      #    .word   .L16+1
      #    .word   .L17+1
      #    .word   .L18+1
      # ```
      # The target .L14 and the others are Thumb instructions, and so
      # the labels in the jump-table are adjusted as shown above.
      # For now, disable this test for ubuntu16.
      version: ["18.04","20.04"]

  - name: ex_virtualDispatch
    <<: *default
    reassemble:
      compiler: "arm-linux-gnueabihf-g++"
      flags: []
      skip: false

  - name: ex_uninitialized_data
    <<: *default
